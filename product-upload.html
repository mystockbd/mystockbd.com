<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶™‡¶£‡ßç‡¶Ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° | MyStockBD</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<style>
:root {
  --primary: #e65100;
  --primary-light: #ff9800;
  --bg: #f5f6f8;
  --card: #fff;
  --text: #1a1a1a;
  --radius: 12px;
  --shadow: 0 4px 12px rgba(0,0,0,0.1);
}
/* Reset */
* { 
  box-sizing: border-box; 
  margin: 0; 
  padding: 0; 

  /* üîπ ‡¶∏‡¶¨ element select/copy ‡¶¨‡¶®‡ßç‡¶ß */
  -webkit-user-select: none;  
  -moz-user-select: none;     
  -ms-user-select: none;      
  user-select: none;          
  -webkit-touch-callout: none; 
}

/* üîπ ‡¶∂‡ßÅ‡¶ß‡ßÅ input ‡¶Ü‡¶∞ textarea-‡¶§‡ßá select allow ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
input, textarea {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);padding-bottom:80px;}
.topbar{background:var(--card);box-shadow:var(--shadow);padding:14px 20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10;}
.brand{font-size:18px;font-weight:600;color:var(--primary);}
.icon-btn{cursor:pointer;color:var(--primary);}
h2{text-align:center;margin-bottom:20px;color:var(--primary);}
form{background:var(--card);padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);}
label{font-weight:500;margin-bottom:4px;display:block;}
input, textarea, select{padding:12px;width:100%;margin-bottom:16px;border:1px solid #ccc;border-radius:var(--radius);font-size:14px;}
input:focus, textarea:focus, select:focus{border-color:var(--primary);outline:none;}
textarea{resize:vertical;}
.btn{display:inline-block;padding:12px 24px;border:none;border-radius:var(--radius);cursor:pointer;font-weight:600;color:#fff;text-align:center;}
.btn-primary{background:linear-gradient(90deg,var(--primary-light),var(--primary));}
.btn-primary:hover{transform:translateY(-2px);}
.btn-secondary{background:#4caf50;margin-bottom:20px;}
.btn-secondary:hover{opacity:0.9;}
#imageContainer .image-field{display:flex; gap:10px; margin-bottom:10px;}
#imageContainer .image-field input{flex:1;}
.image-preview{display:flex; gap:10px; margin-bottom:16px;}
.image-preview img{width:80px; height:80px; object-fit:cover; border-radius:var(--radius); border:1px solid #ccc;}
small{display:block;margin-top:-10px;margin-bottom:10px;color:red;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid #eee;display:flex;justify-content:space-around;padding:8px 0;}
.bottom-nav div{text-align:center;font-size:12px;color:#666;cursor:pointer;}
.bottom-nav .active{color:var(--primary);font-weight:600;}
.material-icons-outlined{font-size:20px;display:block;}
</style>
</head>
<body>

<!-- Topbar with Back Arrow -->
<div class="topbar">
  <div class="topbar-left" style="display:flex;align-items:center;gap:12px;cursor:pointer;">
    <span class="material-icons-outlined">arrow_back</span>
    <span class="brand">MyStockBD</span>
  </div>
  <div style="display:flex;align-items:center;gap:16px;">
    <span class="material-icons-outlined icon-btn">logout</span>
  </div>
</div>

<h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>

<form id="productForm">
  <label>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
  <input type="text" id="title" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
  <p id="titleCounter" style="font-size:12px;color:var(--primary);margin-top:-10px;margin-bottom:10px;">0/60</p>

  <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</label>
  <textarea id="description" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" rows="4" required></textarea>
  <p id="descCounter" style="font-size:12px;color:var(--primary);margin-top:-10px;margin-bottom:10px;">0/100</p>

  <label>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</label>
  <input type="number" id="price" placeholder="‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>

  <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</label>
  <select id="category" required>
    <option value="">-- ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
    <option value="electronics">‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡¶∏</option>
    <option value="fashion">‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶®</option>
    <option value="home_kitchen">‡¶π‡ßã‡¶Æ & ‡¶ï‡¶ø‡¶ö‡ßá‡¶®</option>
    <option value="beauty_personal_care">‡¶¨‡¶ø‡¶â‡¶ü‡¶ø & ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶ï‡ßá‡ßü‡¶æ‡¶∞</option>
    <option value="books_stationery">‡¶¨‡¶á & ‡¶∏‡ßç‡¶ü‡ßá‡¶∂‡¶®‡¶æ‡¶∞‡¶ø</option>
    <option value="sports_outdoors">‡¶∏‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶∏ & ‡¶Ü‡¶â‡¶ü‡¶°‡ßã‡¶∞‡¶∏</option>
    <option value="toys_baby">‡¶ü‡ßü‡¶∏ & ‡¶¨‡ßá‡¶¨‡¶ø ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</option>
    <option value="automotive_tools">‡¶Ö‡¶ü‡ßã‡¶Æ‡ßã‡¶ü‡¶ø‡¶≠ & ‡¶ü‡ßÅ‡¶≤‡¶∏</option>
    <option value="grocery_food">‡¶ó‡ßç‡¶∞‡ßã‡¶∏‡¶æ‡¶∞‡¶ø & ‡¶´‡ßÅ‡¶°</option>
    <option value="misc_others">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
  </select>

  <label>Delivery Charge / Shipping Info:</label>
  <textarea id="deliveryCharge" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá 100‡ß≥, ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá 200‡ß≥" rows="2" required></textarea>

  <label>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (PostImages ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®):</label>
  <button type="button" id="openPostImage" class="btn btn-secondary">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  <small>üìå ‡¶∏‡¶∞‡ßç‡¶¨‡¶æ‡¶ß‡¶ø‡¶ï ‡ß©‡¶ü‡¶ø Image URL ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</small>

  <div class="image-preview" id="imagePreview"></div>

  <div id="imageContainer">
    <div class="image-field">
      <input type="url" class="imageUrl" placeholder="Image URL 1" required>
    </div>
  </div>
  <button type="button" id="addImageBtn" class="btn btn-secondary">+ ‡¶Ü‡¶∞‡¶ì ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>

  <button type="submit" class="btn btn-primary">‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</form>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-profile"><span class="material-icons-outlined">person</span>Profile</div>
  <div class="nav-products"><span class="material-icons-outlined">inventory_2</span>Products</div>
  <div class="nav-orders"><span class="material-icons-outlined">shopping_bag</span>Orders</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
import { getFirestore, doc, getDoc, collection, setDoc } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuGBZ9wJ2i29fIR2YjtUHqAqa58hkKXug",
  authDomain: "mystockbd-2562f.firebaseapp.com",
  projectId: "mystockbd-2562f",
  storageBucket: "mystockbd-2562f.appspot.com",
  messagingSenderId: "502104908886",
  appId: "1:502104908886:web:ec887afe724c0f1a2f87f7",
  measurementId: "G-X85X54F9CK"
};

const app = initializeApp(firebaseConfig);
const firestore = getFirestore(app);
const auth = getAuth(app);

document.addEventListener("DOMContentLoaded", () => {

  // Highlight Products tab
  document.querySelector(".nav-products").classList.add("active");

  let currentUser = null;

  // Login check
  onAuthStateChanged(auth, async (user) => {
    if(!user){
      alert("‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø!");
      window.location.href = "login.html";
      return;
    }
    currentUser = user;
  });

  // Topbar Back arrow
  const topbarLeft = document.querySelector(".topbar-left");
  if(topbarLeft){
    topbarLeft.addEventListener("click", () => {
      window.location.href = "profile.html";
    });
  }

  // Logout
  const logoutBtn = document.querySelector(".icon-btn:last-child");
  if(logoutBtn){
    logoutBtn.addEventListener("click", () => {
      signOut(auth)
        .then(()=>window.location.href='login.html')
        .catch(err=>alert("Logout error: "+err.message));
    });
  }

  // Bottom nav
  const navProfile = document.querySelector(".nav-profile");
  const navProducts = document.querySelector(".nav-products");
  const navOrders = document.querySelector(".nav-orders");
  if(navProfile) navProfile.addEventListener("click", ()=> window.location.href="profile.html");
  if(navProducts) navProducts.addEventListener("click", ()=> window.location.href="my-product.html");
  if(navOrders) navOrders.addEventListener("click", ()=> window.location.href="orders.html");

  // PostImages helper
  const openPostImage = document.getElementById("openPostImage");
  if(openPostImage){
    openPostImage.addEventListener("click", function() {
      alert("üìå ‡¶õ‡¶¨‡¶ø PostImages ‡¶è ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç Direct Link copy ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
      window.open("https://postimages.org/", "_blank");
    });
  }

  // Add more image input
  const addImageBtn = document.getElementById("addImageBtn");
  const imageContainer = document.getElementById("imageContainer");
  const imagePreview = document.getElementById("imagePreview");
  let imageCount = 1;

  function updatePreview(){
    imagePreview.innerHTML = "";
    const urls = document.querySelectorAll(".imageUrl");
    urls.forEach(urlInput=>{
      if(urlInput.value.trim()){
        const img = document.createElement("img");
        img.src = urlInput.value.trim();
        imagePreview.appendChild(img);
      }
    });
  }

  if(addImageBtn && imageContainer){
    addImageBtn.addEventListener("click", () => {
      if(imageCount >= 3){
        alert("‚ö†Ô∏è ‡¶∏‡¶∞‡ßç‡¶¨‡¶æ‡¶ß‡¶ø‡¶ï ‡ß©‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®!");
        return;
      }
      imageCount++;
      const div = document.createElement("div");
      div.className = "image-field";
      div.innerHTML = `<input type="url" class="imageUrl" placeholder="Image URL ${imageCount}" required>`;
      imageContainer.appendChild(div);
      div.querySelector("input").addEventListener("input", updatePreview);
    });
  }

  const firstImageInput = document.querySelector(".imageUrl");
  if(firstImageInput) firstImageInput.addEventListener("input", updatePreview);

  // Character counters
  const titleInput = document.getElementById("title");
  const descInput = document.getElementById("description");
  const titleCounter = document.getElementById("titleCounter");
  const descCounter = document.getElementById("descCounter");

  titleInput.addEventListener("input", () => {
    if(titleInput.value.length > 60) titleInput.value = titleInput.value.substring(0,60);
    titleCounter.textContent = `${titleInput.value.length}/60`;
  });

  descInput.addEventListener("input", () => {
    if(descInput.value.length > 100) descInput.value = descInput.value.substring(0,100);
    descCounter.textContent = `${descInput.value.length}/100`;
  });

  // Form submit
  const form = document.getElementById("productForm");
  if(form){
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if(!currentUser){ alert("‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø!"); return; }

      const title = titleInput.value.trim();
      const description = descInput.value.trim();
      const price = parseFloat(document.getElementById("price").value);
      if(price <= 0){ alert("‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø 0-‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶°‡¶º ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!"); return; }
      const category = document.getElementById("category").value;
      const deliveryCharge = document.getElementById("deliveryCharge").value.trim();
      const sellerId = currentUser.uid;

      const imageInputs = document.querySelectorAll(".imageUrl");
      const imageUrls = Array.from(imageInputs)
        .map(input => input.value.trim())
        .filter(url => url);

      if(imageUrls.length === 0 || imageUrls.length > 3){
        alert("‚ö†Ô∏è ‡ßß‚Äì‡ß©‡¶ü‡¶ø‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá!");
        return;
      }

      const mainImage = imageUrls[0];
      const otherImages = imageUrls.slice(1);

      try {
        const sellerDoc = await getDoc(doc(firestore, "sellers", sellerId));
        if(!sellerDoc.exists()){
          alert("Seller information ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
          return;
        }
        const storeId = sellerDoc.data().storeId;
        if(!storeId){
          alert("Seller-‡¶è‡¶∞ Store ID ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
          return;
        }

        const productRef = doc(collection(firestore, `stores/${storeId}/products`));
        await setDoc(productRef, {
          productId: productRef.id,
          title,
          description,
          price,
          mainImage,
          otherImages,
          category,
          deliveryCharge,
          sellerId,
          storeId,
          status: "active",
          timestamp: Date.now()
        });

        alert("‚úÖ ‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        window.location.href = "my-product.html";

      } catch (error) {
        console.error("Firestore error:", error);
        alert("‚ùå ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + error.message);
      }
    });
  }

});
</script>

</body>
</html>
